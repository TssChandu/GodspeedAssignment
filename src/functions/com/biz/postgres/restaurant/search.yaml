summary: Search Many Restaurants
tasks:
  - id: postgres_restaurant_search
    fn: com.gs.datastore
    args:
      datasource: postgres
      data:
        where:
          location: <% inputs.query.city %>
        include: |
          <% if inputs.query.couponCode then {
            menuItems:
              where:
                couponCode:
                  equals: <% inputs.query.couponCode %>
          } else {
            menuItems: true
          }%>
      config:
        method: Restaurant.findMany
